From e5ab70d1c8341f2290a31e236ce1573c23611e8e Mon Sep 17 00:00:00 2001
From: jgudec <jakov.gudec@gmail.com>
Date: Tue, 9 Aug 2022 08:06:58 +0100
Subject: [PATCH] Update default toggles and add detection for S21 units

---
 app/src/main/java/me/phh/treble/app/Misc.kt   | 28 +++++++++++--------
 .../main/java/me/phh/treble/app/Samsung.kt    | 26 +++++++++--------
 2 files changed, 32 insertions(+), 22 deletions(-)

diff --git a/app/src/main/java/me/phh/treble/app/Misc.kt b/app/src/main/java/me/phh/treble/app/Misc.kt
index e97e63c..651f912 100644
--- a/app/src/main/java/me/phh/treble/app/Misc.kt
+++ b/app/src/main/java/me/phh/treble/app/Misc.kt
@@ -273,17 +273,23 @@ object Misc: EntryStartup {
 
         val c = this.ctxt.get()
 
-        if(!sp.getBoolean(MiscSettings.multiCameras,false)){
-            sp.edit().putBoolean(MiscSettings.multiCameras , true).apply()
-        }
-        if(sp.getString(MiscSettings.minHz,"-1") == "-1"){
-            sp.edit().putString(MiscSettings.minHz , "24").apply()
-        }
-        if(sp.getString(MiscSettings.maxHz,"-1") == "-1"){
-            sp.edit().putString(MiscSettings.maxHz , "120").apply()
-        }
-        if(sp.getString(MiscSettings.roundedCorners,"-1") == "-1"){
-            sp.edit().putString(MiscSettings.roundedCorners , "48").apply()
+        val prop = SystemProperties.get("ro.vendor.build.fingerprint");
+        if("samsung/r0s" in prop || "samsung/g0s" in prop || "samsung/b0s" in prop || "samsung/o1s" in prop || "samsung/t2s" in prop || "samsung/p3s" in prop){
+            if(!sp.getBoolean(MiscSettings.multiCameras,false)){
+                sp.edit().putBoolean(MiscSettings.multiCameras , true).apply()
+            }
+            if(!sp.getBoolean(MiscSettings.forceCamera2APIHAL3,false)){
+                sp.edit().putBoolean(MiscSettings.forceCamera2APIHAL3 , true).apply()
+            }
+            if(sp.getString(MiscSettings.minHz,"-1") == "-1"){
+                sp.edit().putString(MiscSettings.minHz , "24").apply()
+            }
+            if(sp.getString(MiscSettings.maxHz,"-1") == "-1"){
+                sp.edit().putString(MiscSettings.maxHz , "120").apply()
+            }
+            if(sp.getString(MiscSettings.roundedCorners,"-1") == "-1"){
+                sp.edit().putString(MiscSettings.roundedCorners , "48").apply()
+            }
         }
     }
 }
diff --git a/app/src/main/java/me/phh/treble/app/Samsung.kt b/app/src/main/java/me/phh/treble/app/Samsung.kt
index d025330..9559af3 100644
--- a/app/src/main/java/me/phh/treble/app/Samsung.kt
+++ b/app/src/main/java/me/phh/treble/app/Samsung.kt
@@ -122,17 +122,21 @@ class Samsung: EntryStartup {
                         .setApplicationEnabledSetting(malware, PackageManager.COMPONENT_ENABLED_STATE_DISABLED, 0)
             } catch (t: Throwable) { }
         }
-        // if(!sp.getBoolean(SamsungSettings.extraSensors,false)){
-        //     sp.edit().putBoolean(SamsungSettings.extraSensors , true).apply()
-        // }
-        if(!sp.getBoolean(SamsungSettings.cameraIds,false)){
-            sp.edit().putBoolean(SamsungSettings.cameraIds , true).apply()
-        }
-        if(!sp.getBoolean(SamsungSettings.alternateAudioPolicy,false)){
-            sp.edit().putBoolean(SamsungSettings.alternateAudioPolicy , true).apply()
-        }
-        if(!sp.getBoolean(SamsungSettings.highBrightess,false)){
-            sp.edit().putBoolean(SamsungSettings.highBrightess , true).apply()
+        
+        val prop = SystemProperties.get("ro.vendor.build.fingerprint");
+        if("samsung/r0s" in prop || "samsung/g0s" in prop || "samsung/b0s" in prop || "samsung/o1s" in prop || "samsung/t2s" in prop || "samsung/p3s" in prop){
+            if(!sp.getBoolean(SamsungSettings.extraSensors,false)){
+                sp.edit().putBoolean(SamsungSettings.extraSensors , true).apply()
+            }
+            if(!sp.getBoolean(SamsungSettings.cameraIds,false)){
+                sp.edit().putBoolean(SamsungSettings.cameraIds , true).apply()
+            }
+            if(!sp.getBoolean(SamsungSettings.alternateAudioPolicy,false)){
+                sp.edit().putBoolean(SamsungSettings.alternateAudioPolicy , true).apply()
+            }
+            if(!sp.getBoolean(SamsungSettings.highBrightess,false)){
+                sp.edit().putBoolean(SamsungSettings.highBrightess , true).apply()
+            }
         }
 
     }
-- 
2.17.1

