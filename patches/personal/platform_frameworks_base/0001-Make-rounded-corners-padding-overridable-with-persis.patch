From 8cb6ad4220c2c18b01b60260e1557e8592bef8c4 Mon Sep 17 00:00:00 2001
From: Pierre-Hugues Husson <phh@phh.me>
Date: Mon, 26 Jun 2023 19:56:00 +0100
Subject: [PATCH] Make rounded corners padding overridable with
 persist.sys.phh.rounded_corners_padding

---
 .../systemui/statusbar/phone/KeyguardStatusBarView.java  | 9 +++++++--
 .../statusbar/phone/StatusBarContentInsetsProvider.kt    | 6 ++++--
 2 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
index 5f76c92a939a..49afbdd0392f 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
@@ -61,6 +61,7 @@ import com.android.systemui.user.ui.viewmodel.StatusBarUserChipViewModel;
 
 import java.io.PrintWriter;
 import java.util.ArrayList;
+import android.os.SystemProperties;
 
 /**
  * The header group on Keyguard.
@@ -100,6 +101,8 @@ public class KeyguardStatusBarView extends RelativeLayout {
      * Draw this many pixels into the left/right side of the cutout to optimally use the space
      */
     private int mCutoutSideNudge = 0;
+	
+	private int mRoundedCornerPadding = 0;
 
     private DisplayCutout mDisplayCutout;
     // right and left padding applied to this view to account for cutouts and rounded corners
@@ -204,8 +207,10 @@ public class KeyguardStatusBarView extends RelativeLayout {
                 R.dimen.ongoing_appops_dot_min_padding);
         mCutoutSideNudge = getResources().getDimensionPixelSize(
                 R.dimen.display_cutout_margin_consumption);
-        mRoundedCornerPadding = res.getDimensionPixelSize(
-                R.dimen.rounded_corner_content_padding);
+                mRoundedCornerPadding = SystemProperties.getInt("persist.sys.phh.rounded_corners_padding", -1);
+        if(mRoundedCornerPadding == -1)
+            mRoundedCornerPadding = res.getDimensionPixelSize(
+                    R.dimen.rounded_corner_content_padding);
     }
 
     private void updateVisibilities() {
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarContentInsetsProvider.kt b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarContentInsetsProvider.kt
index c850d4f9c56b..9fd37b93a70b 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarContentInsetsProvider.kt
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarContentInsetsProvider.kt
@@ -43,7 +43,7 @@ import com.android.systemui.util.traceSection
 import java.io.PrintWriter
 import java.lang.Math.max
 import javax.inject.Inject
-
+import android.os.SystemProperties
 /**
  * Encapsulates logic that can solve for the left/right insets required for the status bar contents.
  * Takes into account:
@@ -231,7 +231,9 @@ class StatusBarContentInsetsProvider @Inject constructor(
     ): Rect {
         val currentRotation = getExactRotation(context)
 
-        val roundedCornerPadding = rotatedResources
+        var roundedCornerPadding = SystemProperties.getInt("persist.sys.phh.rounded_corners_padding", -1);
+        if(roundedCornerPadding == -1)
+            roundedCornerPadding = rotatedResources
                 .getDimensionPixelSize(R.dimen.rounded_corner_content_padding)
         val minDotPadding = if (isPrivacyDotEnabled)
                 rotatedResources.getDimensionPixelSize(R.dimen.ongoing_appops_dot_min_padding)
-- 
2.17.1

